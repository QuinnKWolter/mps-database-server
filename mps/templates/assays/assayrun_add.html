{% extends "base.html" %}
{% load static %}

{% block load %}
    <script src="{% static "assays/customize_run.js" %}"></script>
    <script src="{% static "js/enter_override.js" %}"></script>
{% endblock %}

{% block content %}

<script>
    $(function() {
        var date = $("#id_start_date");
        var curr_date = date.val();
        //Add datepicker to assay and readout start time
        date.datepicker();
        date.datepicker("option","dateFormat","yy-mm-dd");
        date.datepicker("setDate" , curr_date);
    });
</script>

{% if update %}
    <form onsubmit="return confirm('Are you sure you want to overwrite this entry?');" enctype="multipart/form-data" class="form-horizontal" method="post" >

    <h1>
        Edit {{ object }}
{% else %}
    <form enctype="multipart/form-data" class="form-horizontal" method="post" >

    <h1>
        Add Study
{% endif %}
    {% csrf_token %}
    {{ formset.management_form }}

        <button id="submit" type="submit" class="btn btn-primary">Submit</button>

        {% if update %}
            <a role="button" class="btn btn-danger pull-right" href="/assays/{{ object.id }}/delete/">Delete</a>
        {% endif %}
    </h1>

    <legend>Study Details</legend>

{#    {% if form.center_id.errors %}#}
{#        {% for error in form.center_id.errors %}#}
{#            <div class="alert alert-danger" role="alert">#}
{#                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>#}
{#                <span class="sr-only">Error:</span>#}
{#                {{error}}#}
{#            </div>#}
{#        {% endfor %}#}
{#    <div class="form-group has-error">#}
{#    {% else %}#}
{#    <div class="form-group">#}
{#    {% endif %}#}
{#        <label for="center_id" class="col-sm-2 control-label">Center(s)*</label>#}
{#        <div class="col-sm-10">#}
{#          {{ form.center_id }}#}
{#        </div>#}
{#    </div>#}

    {% if form.group.errors %}
        {% for error in form.group.errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{error}}
            </div>
        {% endfor %}
    <div class="form-group has-error">
    {% else %}
    <div class="form-group">
    {% endif %}
        <label for="group" class="col-sm-2 control-label">Group*</label>
        <div class="col-sm-10">
          <select id="id_group" name="group">
            {% if groups|length > 1 %}
                <option value="">---------</option>
            {% endif %}
            {% for group in groups %}
              {# It is necessary to coerce the forms value into an integer for this compare #}
              {% if group.id|add:"0" == form.group.value|add:"0" %}
                <option value={{ group.id }} selected>{{ group.name }}</option>
              {% else %}
                <option value={{ group.id }}>{{ group.name }}</option>
              {% endif %}
            {% endfor %}
          </select>
          <span id="center_name"></span>
        </div>
    </div>

    {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
            <span class="sr-only">Error:</span>
            {{ form.non_field_errors }}
        </div>
    <div class="form-group has-error">
    {% else %}
    <div class="form-group">
    {% endif %}
        <label for="study_type" class="col-sm-2 control-label">Study Types*</label>
        <div class="col-sm-10">
            <label for="toxicity" style="padding-right: 10px;">Toxicity</label>
              {{ form.toxicity }}
            <label for="efficacy" style="padding-left: 20px;padding-right: 10px;">Efficacy</label>
              {{ form.efficacy }}
            <label for="disease" style="padding-left: 20px;padding-right: 10px;">Disease</label>
              {{ form.disease }}
            <label for="efficacy" style="padding-left: 20px;padding-right: 10px;">Cell Characterization</label>
              {{ form.cell_characterization }}
        </div>
    </div>

    {% if form.study_configuration.errors %}
        {% for error in form.study_configuration.errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{error}}
            </div>
        {% endfor %}
    <div class="form-group has-error">
    {% else %}
    <div class="form-group">
    {% endif %}
        <label for="study_configuration" class="col-sm-2 control-label">Study Configuration*</label>
        <div class="col-sm-10">
          {{ form.study_configuration }}
        </div>
    </div>

    {% if form.name.errors %}
        {% for error in form.name.errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{error}}
            </div>
        {% endfor %}
    <div class="form-group has-error">
    {% else %}
    <div class="form-group">
    {% endif %}
        <label for="study_name" class="col-sm-2 control-label">Study Name*</label>
        <div class="col-sm-10">
          {{ form.name }}
        </div>
    </div>

    {% if form.start_date.errors %}
        {% for error in form.start_date.errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{error}}
            </div>
        {% endfor %}
    <div class="form-group has-error">
    {% else %}
    <div class="form-group">
    {% endif %}
        <label for="start_date" class="col-sm-2 control-label">Start Date*</label>
        <div class="col-sm-10">
          {{ form.start_date }} [yyyy-mm-dd]
        </div>
    </div>

    {% if form.assay_run_id.errors %}
        {% for error in form.assay_run_id.errors %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{error}}
            </div>
        {% endfor %}
    <div class="form-group has-error">
    {% else %}
    <div class="form-group">
    {% endif %}
        <label for="assay_run_id" class="col-sm-2 control-label">Study ID</label>
        <div class="col-sm-10">
          {{ form.assay_run_id }}
        </div>
    </div>

    <div class="form-group">
        <label for="description" class="col-sm-2 control-label">Description</label>
        <div class="col-sm-10">
          {{ form.description }}
        </div>
    </div>

{#    <legend>Bulk Import</legend>#}
{#    <div class="form-group">#}
{#        <label for="file" class="col-sm-2 control-label">File</label>#}
{#        <div class="col-sm-10">#}
{#          {{ form.file }}#}
{#        </div>#}
{#    </div>#}

    <div class="form-group">
        <label for="restricted" class="col-sm-2 control-label">Restrict Access</label>
        <div class="col-sm-10">
          {{ form.restricted }}
        </div>
    </div>
</form>

{% endblock %}
