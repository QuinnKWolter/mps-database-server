{% extends "base.html" %}
{% load static %}

{% block load_js %}
    <script src="{% static "assays/assayplatereadermap_add.js" %}"></script>
{% endblock %}

{% block breadcrumbs %}
    {% comment - this would go back to main study page %}
    <li><a href="/assays/assaystudy/">Studies</a></li>
    <li><a href="{{ form.instance.study.get_absolute_url }}">{{ form.instance.study }}</a></li>
    <li class="active">
        {% if add %}
            Add
        {% elif review %}
            View <em>{{ object }}</em>
        {% else %}
            Update <em>{{ object }}</em>
        {% endif %}{% endcomment %}
    {# to go to the assay plate map index #}
    <li><a href="/assays/assaystudy/">Studies</a>
    <li><a href="{{ form.instance.study.get_absolute_url }}">{{ form.instance.study }}</a></li>
    {% if object %}
        <li><a href="{% url 'assayplatereadermap-index' object.study.id %}">Assay Plate Reader Maps</a>
    {% else %}
        <li><a href="{% url 'assayplatereadermap-index' form.instance.study_id %}">Assay Plate Reader Maps</a>
    {% endif %}
    <li class="active">
        {% if object %}
            <em>{{ object }}</em>
        {% else %}
            Add
        {% endif %}
    </li>
{% endblock %}

{% block content %}
    <form class="form-horizontal" method="post" enctype="multipart/form-data">
        <div class="padded-bottom">
            {# Title of page #}
            <div class="well">
                <h1 class="text-center">
                    <em><b>
                    {% if update %}
                        Update
                    {% else %}
                        {% if review %}
                            Review
                        {% else %}
                            Add
                        {% endif %}
                    {% endif %}
                    Assay Plate Map
                    </b></em><br><br>
                {% if update %}
                    {{ object.device }} Well Plate Map: <em>{{ object }}</em>
                {% else %}
                    {% if review %}
                        {{ object.device }} Well Plate Map: <em>{{ object }}</em>
                    {% else %}
                        to Study {{ form.instance.study }}
                    {% endif %}
                {% endif %}
                <br>
                {% csrf_token %}
                {# need this in javascript #}
                <div id="check_load" class="hidden">{{ page_called }}</div>
                </h1>
            </div>

            <div >
                {# need this in javascript - will generate an id#}
                <div class="hidden">
                    {{ assay_map_additional_info.ns_matrix_item }}
                    {{ assay_map_additional_info.ns_location }}
                    {{ form.ns_file_pk_block_pk }}
                </div>
                {# need this in javascript - needs an id specified#}
                <div class="hidden" id="matrix_list_size" >
                    {{ matrix_list_size }}
                </div>
                {# need this in javascript - needs an id specified#}
                <div class="hidden" id="matrix_list_pk" >
                    {{ matrix_list_pk }}
                </div>
                {# need this in javascript to pass to ajax #}
                <div class="hidden" id="this_study_id" >
                    {% if object %}
                        {{ object.study.id }}
                    {% else %}
                        {{form.instance.study_id}}
                    {% endif %}
                </div>
{#                <div id = "test_me1"></div>#}
{#                <div id = "test_me2"></div>#}
             </div>

            <div>
                {# if want to pass and display a test input widget #}
{#                    <div class="row">#}
{#                        <div class="col-md-8">#}
{#                                {% include 'generic_field.html' with field=form.my_test label="My Test"  %}#}
{#                        </div>#}
{#                    </div>#}
            </div>

            {# global plate map edits #}
            <div>
                {# if add, show users options for starting place, do not use if add in template cause need the form.device #}
                <div class="container show-when-add">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels">
                                <div><p ></p>
                                    <label ><i>Start From</i></label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-radio-contents">
                                <label><input type="radio" name="start_map" value="a_plate" checked> Blank Assay Plate Map </label>
                                <label><input type="radio" name="start_map" value="a_platemap"> Existing Assay Plate Map </label>
                                <label><input type="radio" name="start_map" value="a_matrix"> Existing Study Matrix </label>
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>

                    <div>
                        <div class="pick-a-plate">
                            <div class=row">
                                <div class="col-md-3">
                                    <div class="plate-map-page-field-labels">
                                        <div><p id="plate_select_tooltip"></p>
                                            <label for="plate_select_tooltip">Starting Plate Format* &nbsp;</label>
                                        </div>
                                    </div>
                                </div>
                                {#  this is id_device and it is used in drawing the plate map for all drawing options #}
                                <div class="col-md-6">
                                    <div class="plate-map-page-field-contents required">
                                        {{ form.device }}
                                    </div>
                                </div>
                                <div class="col-md-3"></div>
                            </div>
                        </div>
                        <div class="pick-a-platemap hidden">
                            <div class="row">
                                <div class="col-md-3">
                                     <div class="plate-map-page-field-labels">
                                        <div><p id="platemap_select_tooltip"></p>
                                            <label for="platemap_select_tooltip">Starting Plate Map* &nbsp;</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="plate-map-page-field-contents required">
                                        {{ assay_map_additional_info.se_platemap }}
                                    </div>
                                </div>
                                <div class="col-md-3"></div>
                            </div>
                        </div>
                        <div class="pick-a-matrix hidden">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="plate-map-page-field-labels">
                                        <div><p id="matrix_select_tooltip"></p>
                                            <label for="matrix_select_tooltip">Starting Study Matrix* &nbsp;</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="plate-map-page-field-contents required">
                                        {{ assay_map_additional_info.se_matrix }}
                                    </div>
                                </div>
                                <div class="col-md-3"></div>
                            </div>
                        </div>
                    </div>
                    {# {% else %}#}
                    {# {% include 'generic_field.html' with field=form.device label="Device" %}#}
                    {# <br><b>form device</b> {% include 'generic_field.html' with field=form.device label="Plate Size"  %}#}
                    {# <br><b>plate size</b> <h4 id="object_plate_size">{{ object.device }}</h4>#}
                    {# <br><b>plate id</b> <h4 id="object_plate_id">{{ object.id }}</h4>#}
                    {# <br><b>study</b> <h4 id="object_study">{{ object.study }}</h4>#}
                    {# <br><b>study id </b> <h4 id="object_study">{{ object.study.id }}</h4>#}
                    {# <br><b>form name</b> {% include 'generic_field.html' with field=form.name label="Map Name"  %}#}

                    {# This takes FOREVER if queryset is not passed (dropdowns often need prefetches) #}
                    {# Study should be passed in backend - do not to the following!#}
                    {# {% include 'generic_field.html' with field=form.study label="Study" %}#}
                    {# <div class="hidden"><p>plate map id {{ object.id }}</p></div>#}
                    {# {{ object.study_assay_id }} #}
                    {# {{ object.study_assay }} #}
                    {# {{ form.instance.study_assay }} #}
                </div>

{#                {% if form.number_file_block_combos > 0 %}#}
                <div class="container">
                    <div class="select-value-set">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="plate-map-page-field-labels">
                                    <div><p id="number_file_block_tooltip"></p>
                                        <label for="number_file_block_tooltip"># File/Blocks &nbsp;</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="plate-map-page-field-contents required">
                                    {{ form.number_file_block_combos }}
                                </div>
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="plate-map-page-field-labels">
                                    <div><p id="file_block_tooltip"></p>
                                        <label for="file_block_tooltip">File/Blocks &nbsp;</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="plate-map-page-field-contents required">
                                    {{ form.se_file_block }}
                                </div>
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                    </div>
                </div>
{#                {% endif %}#}

                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels">
                                <div><p id="map_name_tooltip"></p>
                                    <label for="map_name_tooltip">Map Name* &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents required">
                                {{ form.name }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels">
                                <div><p ></p>
                                    <label >Description (optional)</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents">
                                {{ form.description }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels ">
                                <div><p id="sample_time_unit_tooltip"></p>
                                    <label for="sample_time_unit_tooltip">Time Unit* &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents required">
                                {{ form.time_unit }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels">
                                <div><p id="plate_reader_unit_tooltip"></p>
                                    <label for="plate_reader_unit_tooltip">Plate Reader Unit* &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents required">
                                {{ form.plate_reader_unit }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels">
                                <div><p id="plate_cell_count_tooltip"></p>
                                    <label for="plate_cell_count_tooltip"># Cells &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents ">
                                {{ form.cell_count }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels">
                                <div><p id="collection_volume_unit_tooltip"></p>
                                    <label for="collection_volume_unit_tooltip">Volume Unit &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents ">
                                {{ form.volume_unit }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="plate-map-page-field-labels">
                                <div><p id="standard_tooltip"></p>
                                    <label for="standard_tooltip">Assay Standard* &nbsp;</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="plate-map-page-field-contents required">
                                {{ form.study_assay }}
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                </div>
            </div>

            {# Selecting what to work on   #}
            <div>
                <div class="container">
                    <hr>
                    <div class="row">
                        {% if not review %}
                            <div class="col-md-3">
                                <div class="plate-map-page-field-labels">
                                    <div>
                                        <div><p id="well_use_tooltip"></p>
                                            <label for="well_use_tooltip">Select Well Content to Place on Map &nbsp;</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="plate-map-page-field-contents">
                                    {{ assay_map_additional_info.se_well_use }}
                                </div>
                            </div>
                        {% endif %}
                        <div class="col-md-4">
                            <button type="button" class="btn btn-primary" id="checkboxButton">Show/Hide Customized Map Display Options</button>
                        </div>
                        <div class="col-md-3">
                        </div>
                    </div>
                </div>
            </div>


            {# Working on the Samples #}
            <div>
                {# rows of select boxes used to edit  #}
                {% if not review %}
                    <div class="container">
                        <div class="sample-section hidden ">
                            <div class="row">
                                <div class="col-md-3">
                                    <div><p id="sample_matrix_item_tooltip"></p>
                                        <label for="sample_matrix_item_tooltip">Study Matrix Item &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div><p id="sample_location_tooltip"></p>
                                        <label for="sample_location_tooltip">Assay Sample Location &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div><p id="sample_time_tooltip"></p>
                                        <label for="sample_time_tooltip">Assay Sample Time &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2 plate-map-page-field-contents ">
                                    {{ assay_map_additional_info.se_matrix_item }}
                                </div>
                                <div class="col-md-1">
                                    <div>
                                        {#  <label class="sample-section hidden"><input type="radio" name="sample_change" value="matrix_item"> Apply </label>#}
                                        <input id="checkbox_matrix_item" class="big-checkbox plate-map-check-box" type="checkbox" name="change_matrix_item" value="matrix_item" checked />
                                    </div>
                                </div>

                                <div class="col-md-2 plate-map-page-field-contents ">
                                    {{ assay_map_additional_info.se_location }}
                                </div>
                                <div class="col-md-1">
                                    <div>
                                        {#  <label class="sample-section hidden"><input type="radio" name="sample_change" value="location"> Apply </label>#}
                                        <input id="checkbox_location" class="big-checkbox plate-map-check-box" type="checkbox" name="change_location" value="location" checked />
                                    </div>
                                </div>

                                <div class="col-md-2 plate-map-page-field-contents ">
                                    {{ assay_map_additional_info.se_time }}
                                </div>
                                <div class="col-md-1">
                                    <div>
                                        {#  <label class="sample-section hidden"><input type="radio" name="sample_change" value="time"> Apply </label>#}
                                        <input id="checkbox_time" class="big-checkbox plate-map-check-box" type="checkbox" name="change_time" value="time" checked />
                                    </div>
                                </div>
                                <div class="col-md-3">
                                </div>
                            </div>
                        </div>

                        <div class="sample-section hidden ">
                            <div class="row">
                                <div class="col-md-3">
                                    <div><p id="dilution_factor_tooltip"></p>
                                        <label for="dilution_factor_tooltip">Sample Dilution Factor &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div><p id="collection_volume_tooltip"></p>
                                        <label for="collection_volume_tooltip">Efflux Collected Volume &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div><p id="collection_time_tooltip"></p>
                                        <label for="collection_time_tooltip">Efflux Collection Time &nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                </div>
                            </div>
                            <div class="row">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-2 plate-map-page-field-contents ">
                                            {{ assay_map_additional_info.se_dilution_factor }}
                                        </div>
                                        <div class="col-md-1">
                                            <div>
                                                <input id="checkbox_dilution_factor" class="big-checkbox plate-map-check-box" type="checkbox" name="change_dilution_factor" value="matrix_dilution_factor"  />
                                            </div>
                                        </div>

                                        <div class="col-md-2 plate-map-page-field-contents ">
                                            {{ assay_map_additional_info.se_collection_volume }}
                                        </div>
                                        <div class="col-md-1">
                                            <div>
                                                <input id="checkbox_collection_volume" class="big-checkbox plate-map-check-box" type="checkbox" name="change_collection_volume" value="matrix_collection_volume"  />
                                            </div>
                                        </div>

                                        <div class="col-md-2 plate-map-page-field-contents ">
                                             {{ assay_map_additional_info.se_collection_time }}
                                        </div>
                                        <div class="col-md-1">
                                            <div>
                                                <input id="checkbox_collection_time" class="big-checkbox plate-map-check-box" type="checkbox" name="change_collection_time" value="matrix_collection_time"  />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            {# Working on the Standards #}
            <div>
                {# rows of select boxes used to edit  #}
                {% if not review %}
                    <div class="container">
                        <div class="standard-section hidden ">
                            <div class="row">
                                <div class="col-md-3">
                                    <div><p id="standard_value_tooltip"></p>
                                        <label for="standard_value_tooltip">Standard Value &nbsp;</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-3 plate-map-page-field-contents ">
                                            {{ assay_map_additional_info.se_standard_value }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            {# Options for dragging #}
            <div class="drag-option-section hidden">
                {% if not review %}
                    <div class="container">
                        <div class="row">
{#                        <legend>Options for Drag/Apply in Plate Map</legend>#}
                        <div class="col-md-4">
                            <div class=row">
                                <label>Plate Map Drag and Apply Action</label>
                            </div>
                            <div class=row">
                                <input type="radio" name="change_method" value="copy" checked> Copy
                            </div>
                            <div class=row">
                                <input type="radio" name="change_method" value="increment"> Increment (Time or Standard Value only)
                            </div>
                        </div>
                        <div class="increment-section hidden">
                            <div class="col-md-2">
                                <div class=row">
                                    <label>Increment Operation</label>
                                </div>
                                <div class=row">
                                    {{ assay_map_additional_info.se_increment_operation }}
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class=row">
                                    <label>Increment By</label>
                                </div>
                                <div class=row">
                                    {{ assay_map_additional_info.se_increment_value }}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class=row">
                                    <label>Increment Direction</label>
                                </div>
                                <div class=row">
                                    <input type="radio" name="increment_direction" value="left" checked> Left to Right and Down
                                </div>
                                <div class=row">
                                    <input type="radio" name="increment_direction" value="right"> Right to Left and Up
                                </div>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class=row">
                            </div>
                        </div>
                    </div>
                    </div>
                {% endif %}
            </div>

            {# Customize things to show in the plate map #}
            {# The visibility is also controlled in js file  #}
            <div id="platemap_checkbox_section" class="platemap-checkbox-section">
                <div class="container">
                    <div class="row ">
                        <div class="col-md-12">
                            <table class="table table-striped table-bordered ">
                                <thead>
                                    <tr>
                                        <td>
                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_matrix_item" id="show_matrix_item" value=".matrix_item_start">
                                                <div class="btn-group">
                                                    <label for="show_matrix_item" class="btn plate-matrix-item extra-tall-glyphicon">
                                                        <span class="glyphicon glyphicon-ok  "></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_matrix_item" class="btn btn-default active">
                                                        Matrix Item
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_location" id="show_location" value=".location_start">
                                                <div class="btn-group">
                                                    <label for="show_location" class="btn plate-location extra-tall-glyphicon" >
                                                        <span class="glyphicon glyphicon-ok  "></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_location" class="btn btn-default active">
                                                        Sample Location
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_dilution_factor" id="show_dilution_factor" value=".dilution_factor_start">
                                                <div class="btn-group">
                                                    <label for="show_dilution_factor" class="btn plate-dilution-factor extra-tall-glyphicon" >
                                                        <span class="glyphicon glyphicon-ok  "></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_dilution_factor" class="btn btn-default active">
                                                        Dilution Factor
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_time" id="show_time" value=".time_start"/>
                                                <div class="btn-group">
                                                    <label for="show_time" class="btn plate-time extra-tall-glyphicon" >
                                                        <span class="glyphicon glyphicon-ok "></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_time" class="btn btn-default active">
                                                        Sample Time
                                                    </label>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_well_use" id="show_well_use" value=".well_use_start" >
                                                <div class="btn-group">
                                                    <label for="show_well_use" class="btn plate-well-use" >
                                                        <span class="glyphicon glyphicon-ok"></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_well_use" class="btn btn-default active">
                                                        Well Content
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_standard_value" id="show_standard_value" value=".standard_value_start">
                                                <div class="btn-group">
                                                    <label for="show_standard_value" class="btn plate-standard-value extra-tall-glyphicon">
                                                        <span class="glyphicon glyphicon-ok  "></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_standard_value" class="btn btn-default active">
                                                        Standard Value
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_collection_volume" id="show_collection_volume" value=".collection_volume_start">
                                                <div class="btn-group">
                                                    <label for="show_collection_volume" class="btn plate-collection-volume extra-tall-glyphicon" >
                                                        <span class="glyphicon glyphicon-ok  "></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_collection_volume" class="btn btn-default active">
                                                        Sample Efflux Volume
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_collection_time" id="show_collection_time" value=".collection_time_start">
                                                <div class="btn-group">
                                                    <label for="show_collection_time" class="btn plate-collection-time extra-tall-glyphicon" >
                                                        <span class="glyphicon glyphicon-ok  "></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_collection_time" class="btn btn-default active">
                                                        Sample Efflux Time
                                                    </label>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_label" id="show_label" value=".label_start" >
                                                <div class="btn-group">
                                                    <label for="show_label" class="btn plate-label">
                                                        <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_label" class="btn btn-default active">
                                                      Label
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_compound" id="show_compound" value=".compound_start" >
                                                <div class="btn-group">
                                                    <label for="show_compound" class="btn plate-compound" >
                                                        <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_compound" class="btn btn-default active">
                                                        Compound
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_cell" id="show_cell" value=".cell_start" >
                                                <div class="btn-group">
                                                    <label for="show_cell" class="btn plate-cell" >
                                                        <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_cell" class="btn btn-default active">
                                                        Cells
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                <input class="visibility-checkbox" type="checkbox" name="show_setting" id="show_setting" value=".setting_start" >
                                                <div class="btn-group">
                                                    <label for="show_setting" class="btn plate-setting" >
                                                        <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                        <span> </span>
                                                    </label>
                                                    <label for="show_setting" class="btn btn-default active">
                                                        Settings
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="select-value-set">
                                                {# {% if form.number_file_block_combos > 0 %}#}
                                                <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                                    <input class="visibility-checkbox" type="checkbox" name="show_block_raw_value" id="show_block_raw_value" value=".block_value_start">
                                                    <div class="btn-group">
                                                        <label for="show_block_raw_value" class="btn plate-block-raw-value extra-tall-glyphicon">
                                                            <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                                            <span> </span>
                                                        </label>
                                                        <label for="show_block_raw_value" class="btn btn-default active">
                                                            Raw Value
                                                        </label>
                                                    </div>
                                                </div>
                                                {# {% endif %}#}
                                            </div>
                                        </td>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
{% comment %}
                            <div class="fancy-checkbox table-filter padded-bottom" align="left">
                                <input class="visibility-checkbox" type="checkbox" name="show_compound" id="show_compound" value=".compound_start" >
                                <div class="btn-group">
                                    <label for="show_compound" class="btn plate-compound" >
                                        <span class="glyphicon glyphicon-ok check-mark-color"></span>
                                        <span> </span>
                                    </label>
                                    <label for="show_compound" class="btn btn-default active">
                                        caution flag, exclude, notes
                                    </label>
                                </div>
                            </div>
                        {% endcomment %}

            {# {{  formset }} is the wells in the map   #}
            <div>
{#                <legend>Plate Map</legend>#}
                {#  table of well plate              #}
                <div class="col-md-12">
                    <table class="table table-bordered table-inverse" id="plate_table">
                        {#  note that the table is made in javascript                  #}
                    </table>
                </div>
            </div>

            {% include 'assaystudy_assayplatemap_help.html' %}

            {# reference table of chip setup FEEDS the setup (compounds, cells, settings) info in the PLATE MAP KEEP#}
            <div class="hidden">
                <div class="row">
                    <legend>For Reference - Chips in the Study</legend>
                    {% if matrix_items_in_study|length > 0 %}
                        <div class="padded-bottom">
{#                            <table id="matrix_items_table" class="table table-striped table-bordered dataTable " >#}
                            {#  If the table paginates, rows not on the page are not accessible, so, do not use the class that pagenates  #}
                            <table id="matrix_items_table" class="table table-striped table-bordered dataTable " >
                                <thead>
                                    <tr role="row">
                                        <th>Name</th>
                                        <th>Compound</th>
                                        <th>Compound Short</th>
                                        <th>Cell</th>
                                        <th>Cell Short</th>
                                        <th>Setting</th>
                                        <th>Setting Short</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in matrix_items_in_study %}
                                        <tr {{ item.id }}>
                                            <td>{{ item.name }}</td>
                                            <td id="cp{{ item.id }}-compound">{{ item.stringify_compounds|linebreaksbr }}</td>
                                            <td id="cp{{ item.id }}-compound-short">
                                                {%  if item.assaysetupcompound_set.all|length > 0 %}
                                                    {% for x in item.assaysetupcompound_set.all %}
                                                        {{ x.compound_instance.compound }} ({{ x.concentration }} {{ x.concentration_unit }})<br>
                                                    {% endfor %}
                                                {% else %}
                                                    -none-
                                                {% endif %}
                                            </td>
                                            <td id="cl{{ item.id }}-cell">{{ item.stringify_cells|linebreaksbr }}</td>
                                            <td id="cl{{ item.id }}-cell-short">
                                                {%  if item.assaysetupcell_set.all|length > 0 %}
                                                    {% for x in item.assaysetupcell_set.all %}
                                                        {{ x.cell_sample.cell_type }} ({{ x.density }} {{ x.density_unit }})<br>
                                                    {% endfor %}
                                                {% else %}
                                                    -none-
                                                {% endif %}
                                            </td>
                                            <td id="st{{ item.id }}-setting">{{ item.stringify_settings|linebreaksbr }}</td>
                                            <td id="st{{ item.id }}-setting-short">
                                                {%  if item.assaysetupsetting_set.all|length > 0 %}
                                                    {% for x in item.assaysetupsetting_set.all %}
                                                        {{ x.setting }} ({{ x.value }} {{ x.unit }})<br>
                                                    {% endfor %}
                                                {% else %}
                                                    -none-
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p>Not items have been setup in the study. Need to do that first.</p>
                    {% endif %}
                </div>
            </div>
            <div>
                {% if review %}
                {% else %}
                    {% include "submit.html" with flag="y" creator=object.created_by.id %}
                {% endif %}
            </div>

            {% include 'errors.html' %}

            {% comment %}            <h6>tracking begin</h6>
            {% include 'tracking.html' %}
            <h6>tracking end</h6>{% endcomment %}

            {# need this (mangement_form) or form will not save   #}
            {{ formset.management_form }}
            <div class="hidden">
                <div class="no-selectize">
                    {# this is the main formset (plate and plate items)  #}
                    <h3>FormSet </h3>
                    <div id="formset">
                        {% for form in formset %}
                            {# No ID for now #}
    {#                        <div id="{{ form.prefix }}" class="inline no-selectize">#}
                            <div class="inline no-selectize">
                            {{ form }}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {{ value_formset.management_form }}
            <div class="hidden">
                <div class="no-selectize">
                    <h3>value_formset </h3>
                    <div id="value_formset">
                        {% for form in value_formset %}
                            <div class="inline no-selectize">
                                {{ form }}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {# these are the ones that show to user   #}
            <div>
                {% if formset.errors %}
                    {% for field, error in formset.errors.items %}
                        <div class="alert alert-danger" role="alert">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <span class="sr-only">Error:</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                {% endif %}
                <br>
            </div>

            <div class="hidden">
                <h2>For Development Testing</h2>
                {#Use for error checking#}
                For testing<br>
                form.errors<br>
                {{ form.errors }}<br>
                formset.errors<br>
                {{ formset.errors }}<br>
                value_formset.errors<br>
                {{ value_formset.errors }}<br>
            </div>
        </div>

    </form>
{% endblock %}
