{% extends "base.html" %}
{% load static %}

{% block load_js %}
    <script src="{% static "assays/assaystudyset_add.js" %}"></script>
{% endblock %}

{% block breadcrumbs %}
    {# What will the breadcrumbs be #}
    <li class="active">
        {% if object %}
            Edit <em>{{ object }}</em>
        {% else %}
            Add Study Set
        {% endif %}
    </li>
{% endblock %}

{% block content %}
{% if update %}
    <form enctype="multipart/form-data" class="form-horizontal" method="post" >

    <h1>
        Edit <em>{{ object }}</em>
{% else %}
    <form enctype="multipart/form-data" class="form-horizontal" method="post" >

    <h1>
        Add Study Set
{% endif %}
    <br>
    {% csrf_token %}
    </h1>

    {% include "submit.html" with flag="y" %}

    {% include 'errors.html' %}

    {% include 'tracking.html' %}

    <legend>Study Details</legend>

    {% include 'generic_field.html' with field=form.name label="Study Set Name*" %}

    {% include 'generic_field.html' with field=form.description label="Description*" %}

    <div class="row padded-bottom">
    <div class="col-sm-2"></div>
    <div class="col-sm-10">
    <a role='button' id="select_studies_button" class="btn btn-primary btn-block btn-lg">
        <span class="glyphicon glyphicon-search"></span>
        Select Studies
    </a>
    </div>
    </div>

    {% include 'generic_field.html' with field=form.studies label="Studies*" %}

    {% include 'generic_field.html' with field=form.assays label="Assays" %}

    <legend>Studies</legend>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Study</th>
                <th>Assays</th>
            </tr>
        </thead>
        <tbody id="selected_studies_table">
        </tbody>
    </table>
</form>

{# A little odd, I actually populate this by iterating over the queryset in the form #}
{# (Perhaps it would be more semantic to iterate over something passed in the context #}
<div id="study_dialog" hidden>
    <table class="table table-striped table-bordered" id="study_data_table">
        <thead>
            <tr>
                <th>Select</th>
                <th>Study</th>
            </tr>
        </thead>
        <tbody>
            {% for study in form.studies.field.queryset.all %}
            <tr>
                <td style="text-align:center;">
                    <input type="checkbox" class="big-checkbox study-selector" value="{{ study.id }}">
                </td>
                <td>{{ study }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div hidden id="assay_dialog" title="Select Assays">
    <div class="padded-bottom">
        <a id="assay_filter_section_select_all" class="btn btn-primary">Select All</a>
        <a id="assay_filter_section_deselect_all" class="btn btn-danger">Deselect All</a>
    </div>
    <table id="assay_table" class="display table" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Select</th>
                <th>Target</th>
                <th>Method</th>
                <th>Unit</th>
            </tr>
        </thead>
        <tbody id="assay_dialog_body">
        </tbody>
    </table>
</div>
{% endblock %}
